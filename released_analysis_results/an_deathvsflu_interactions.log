-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  e:\analyses\post-admission-admissions-research\analysis/output/an_deathvsflu_interactions.log
  log type:  text
 opened on:  12 May 2021, 10:42:46

. 
. use analysis/cr_append_process_data, clear

. 
. *Death
. *vs 2017_19-flu controls
. include analysis/stsetfordeath1ocare.doi

. 
. *all use 1ocare
. 
. *Code chunk for looking at death outcome
. 
. cap drop deathexit

. cap drop deathindicator

. cap drop deathfup

. 
. summ died_date_ons, f d

                        died_date_ons
-------------------------------------------------------------
      Percentiles      Smallest
 1%    07mar2019      01feb2019
 5%    23may2019      01feb2019
10%    05aug2019      01feb2019       Obs              11,865
25%    07jan2020      01feb2019       Sum of Wgt.      11,865

50%    09jun2020                      Mean          29may2020
                        Largest       Std. Dev.      200.8664
75%    25nov2020      08apr2021
90%    31jan2021      09apr2021       Variance       40347.29
95%    27feb2021      09apr2021       Skewness      -.4143459
99%    30mar2021      10apr2021       Kurtosis       2.221716

. scalar deathcensor = r(max)-30

. gen deathexit = died_date_1ocare if died_date_1ocare<deathcensor 
(152,421 missing values generated)

. gen deathindicator = died_date_1ocare<(dereg_date) 

. 
. replace deathexit = min(deathcensor, dereg_date) if deathexit==. 
(152,421 real changes made)

. 
. gen deathfup = deathexit-entrydate

. summ deathfup if group==1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    deathfup |     24,673    200.0443    106.8168        -92        386

. local maxfupexposed = r(max)

. replace deathindicator = 0 if deathexit>(entrydate + `maxfupexposed')
(4,468 real changes made)

. replace deathexit = entrydate + r(max) if deathexit>(entrydate + `maxfupexposed')
(131,824 real changes made)

. stset deathexit, enter(entrydate) fail(deathindicator) origin(entrydate)

     failure event:  deathindicator != 0 & deathindicator < .
obs. time interval:  (origin, deathexit]
 enter on or after:  time entrydate
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time entrydate

------------------------------------------------------------------------------
    164,093  total observations
        119  observations end on or before enter()
------------------------------------------------------------------------------
    163,974  observations remaining, representing
      7,439  failures in single-record/single-failure data
   57299935  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       386

. 
. keep if group==1|group==2
(123,362 observations deleted)

.         
. *By age
. stcox exposed age1 age2 age3 male i.stp 1.exposed#2.agegroup 1.exposed#3.agegroup 1.exposed#4.agegroup 1.exposed#5.agegroup 1.exposed#6.agegroup

         failure _d:  deathindicator
   analysis time _t:  (deathexit-origin)
             origin:  time entrydate
  enter on or after:  time entrydate

Iteration 0:   log likelihood =  -36565.08
Iteration 1:   log likelihood = -35485.051
Iteration 2:   log likelihood = -34867.664
Iteration 3:   log likelihood = -34848.101
Iteration 4:   log likelihood = -34848.034
Iteration 5:   log likelihood = -34848.034
Refining estimates:
Iteration 0:   log likelihood = -34848.034

Cox regression -- Breslow method for ties

No. of subjects =       40,642                  Number of obs    =      40,642
No. of failures =        3,535
Time at risk    =     10732237
                                                LR chi2(41)      =     3434.09
Log likelihood  =   -34848.034                  Prob > chi2      =      0.0000

---------------------------------------------------------------------------------------------------------------
                                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
----------------------------------------------+----------------------------------------------------------------
                                      exposed |   .6561377   .2772622    -1.00   0.319     .2866191    1.502051
                                         age1 |   1.079525   .0128463     6.43   0.000     1.054638    1.104999
                                         age2 |   .9539345   .0191266    -2.35   0.019      .917174    .9921683
                                         age3 |   1.211948   .0843799     2.76   0.006     1.057354    1.389145
                                         male |   1.177366   .0401587     4.79   0.000     1.101229    1.258766
                                              |
                                          stp |
                                           2  |   1.171531   1.172966     0.16   0.874     .1646302    8.336772
                                           3  |    1.52356   1.527213     0.42   0.674     .2136079     10.8668
                                           4  |   1.210856   1.224623     0.19   0.850     .1668066    8.789655
                                           5  |   1.289577   1.316282     0.25   0.803      .174429    9.534017
                                           6  |   1.426394   1.428483     0.35   0.723     .2003507    10.15519
                                           7  |   .8130233   .8462678    -0.20   0.842     .1057051    6.253313
                                           8  |   1.187272   1.190659     0.17   0.864     .1663105    8.475795
                                           9  |   1.274869   1.284418     0.24   0.810     .1769654    9.184227
                                          10  |    1.32827   1.331588     0.28   0.777     .1861909    9.475759
                                          11  |    1.36329   1.367807     0.31   0.757     .1907947    9.741147
                                          12  |    .941344   .9518071    -0.06   0.952     .1297435    6.829848
                                          13  |   .8632805   .8689239    -0.15   0.884     .1200566    6.207517
                                          14  |   1.261878   1.269181     0.23   0.817     .1757476    9.060352
                                          15  |   .9750018   .9806117    -0.03   0.980      .135802    7.000105
                                          16  |   1.142449   1.147079     0.13   0.894      .159656    8.175011
                                          17  |   1.204634   1.214561     0.18   0.854     .1669704    8.691027
                                          18  |   1.318173    1.32339     0.28   0.783     .1842476    9.430672
                                          19  |   1.137585   1.145895     0.13   0.898     .1579662    8.192252
                                          20  |   1.354699   1.364089     0.30   0.763     .1882526     9.74865
                                          21  |   .7196602   .7224665    -0.33   0.743      .100602    5.148116
                                          22  |    .284169   .3281533    -1.09   0.276     .0295545    2.732304
                                          23  |   1.001407   1.008702     0.00   0.999     .1390619     7.21129
                                          24  |   1.070709     1.1972     0.06   0.951     .1196497    9.581453
                                          25  |   1.013133   1.044413     0.01   0.990     .1343336     7.64097
                                          26  |   1.096755   1.101212     0.09   0.927     .1532674    7.848196
                                          27  |   1.219701   1.224769     0.20   0.843     .1704179    8.729548
                                          28  |   1.263044   1.269996     0.23   0.816     .1760076    9.063699
                                          29  |   1.136624   1.143978     0.13   0.899     .1580912     8.17195
                                          30  |   .9356192   .9433642    -0.07   0.947     .1296736    6.750669
                                          31  |   .5048311   .7139883    -0.48   0.629     .0315706    8.072535
                                          32  |   1.390683   1.392606     0.33   0.742     .1953664    9.899347
                                              |
                             exposed#agegroup |
Exposed (prior COVID hospitalisation)#40-<50  |   1.218964   .5363225     0.45   0.653     .5146091    2.887384
Exposed (prior COVID hospitalisation)#50-<60  |   1.043405   .4579212     0.10   0.923     .4414531    2.466161
Exposed (prior COVID hospitalisation)#60-<70  |   2.057263    .893176     1.66   0.097     .8784848    4.817761
Exposed (prior COVID hospitalisation)#70-<80  |   2.573254   1.097248     2.22   0.027     1.115645    5.935253
   Exposed (prior COVID hospitalisation)#80+  |   2.826161   1.198102     2.45   0.014     1.231245    6.487079
---------------------------------------------------------------------------------------------------------------

. 
. lincom exposed, hr

 ( 1)  exposed = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .6561377   .2772622    -1.00   0.319     .2866191    1.502051
------------------------------------------------------------------------------

. lincom exposed + 1.exposed#2.agegroup, hr       

 ( 1)  exposed + 1.exposed#2bn.agegroup = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .7998084   .1658853    -1.08   0.281     .5326493    1.200965
------------------------------------------------------------------------------

. lincom exposed + 1.exposed#3.agegroup, hr       

 ( 1)  exposed + 1.exposed#3.agegroup = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .6846175   .0919543    -2.82   0.005     .5261613    .8907934
------------------------------------------------------------------------------

. lincom exposed + 1.exposed#4.agegroup, hr       

 ( 1)  exposed + 1.exposed#4.agegroup = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.349848   .1119638     3.62   0.000     1.147312    1.588138
------------------------------------------------------------------------------

. lincom exposed + 1.exposed#5.agegroup, hr       

 ( 1)  exposed + 1.exposed#5.agegroup = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.688409   .0999457     8.85   0.000     1.503456    1.896115
------------------------------------------------------------------------------

. lincom exposed + 1.exposed#6.agegroup, hr       

 ( 1)  exposed + 1.exposed#6.agegroup = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.854351   .0851237    13.45   0.000     1.694797    2.028926
------------------------------------------------------------------------------

. 
. *By length stay and days critical care
. stcox i.exposed##i.hosp_lte_1 age1 age2 age3 male i.stp 

         failure _d:  deathindicator
   analysis time _t:  (deathexit-origin)
             origin:  time entrydate
  enter on or after:  time entrydate

Iteration 0:   log likelihood =  -36565.08
Iteration 1:   log likelihood = -35192.001
Iteration 2:   log likelihood = -34722.412
Iteration 3:   log likelihood = -34716.838
Iteration 4:   log likelihood = -34716.765
Iteration 5:   log likelihood = -34716.765
Refining estimates:
Iteration 0:   log likelihood = -34716.765

Cox regression -- Breslow method for ties

No. of subjects =       40,642                  Number of obs    =      40,642
No. of failures =        3,535
Time at risk    =     10732237
                                                LR chi2(38)      =     3696.63
Log likelihood  =   -34716.765                  Prob > chi2      =      0.0000

----------------------------------------------------------------------------------------------------------
                                      _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-----------------------------------------+----------------------------------------------------------------
                                 exposed |
  Exposed (prior COVID hospitalisation)  |   1.245689   .0584241     4.68   0.000     1.136286    1.365627
                        1.hosp_lte_1week |   .4338634    .022926   -15.80   0.000     .3911778    .4812069
                                         |
                  exposed#hosp_lte_1week |
Exposed (prior COVID hospitalisation)#1  |   1.538854   .1077756     6.15   0.000     1.341475    1.765275
                                         |
                                    age1 |   1.072087   .0110295     6.77   0.000     1.050686    1.093923
                                    age2 |   .9913654   .0168032    -0.51   0.609     .9589728    1.024852
                                    age3 |   1.021003    .060085     0.35   0.724     .9097765    1.145828
                                    male |   1.189469   .0406546     5.08   0.000     1.112398     1.27188
                                         |
                                     stp |
                                      2  |    1.25079    1.25232     0.22   0.823     .1757687    8.900765
                                      3  |   1.646398   1.650341     0.50   0.619      .230831     11.7429
                                      4  |   1.341654   1.356923     0.29   0.771     .1848213    9.739333
                                      5  |     1.2905   1.317233     0.25   0.803     .1745514    9.540971
                                      6  |   1.497945   1.500134     0.40   0.687     .2104022    10.66452
                                      7  |   .9198661   .9575092    -0.08   0.936     .1195887    7.075535
                                      8  |   1.286897   1.290559     0.25   0.801     .1802687     9.18687
                                      9  |   1.366742   1.376973     0.31   0.756     .1897202       9.846
                                     10  |   1.406191   1.409699     0.34   0.734     .1971148    10.03158
                                     11  |    1.43949   1.444264     0.36   0.717     .2014578    10.28569
                                     12  |   1.003625   1.014775     0.00   0.997      .138329    7.281645
                                     13  |   .9218022    .927824    -0.08   0.936     .1281963    6.628266
                                     14  |    1.29666   1.304157     0.26   0.796     .1805939    9.309988
                                     15  |   1.011328   1.017146     0.01   0.991     .1408621    7.260898
                                     16  |   1.181266   1.186043     0.17   0.868     .1650839    8.452613
                                     17  |   1.278851   1.289381     0.24   0.807     .1772595    9.226358
                                     18  |   1.376176   1.381615     0.32   0.750     .1923569    9.845552
                                     19  |   1.149737   1.158117     0.14   0.890     .1596589    8.279501
                                     20  |   1.468545   1.478725     0.38   0.703     .2040729    10.56791
                                     21  |     .75896   .7619167    -0.27   0.784     .1060966    5.429208
                                     22  |   .2840891   .3280623    -1.09   0.276      .029546    2.731561
                                     23  |   1.019945   1.027363     0.02   0.984     .1416393    7.344623
                                     24  |   1.066851   1.192883     0.06   0.954      .119219    9.546888
                                     25  |    .974188   1.004255    -0.03   0.980     .1291726    7.347086
                                     26  |   1.153682   1.158379     0.14   0.887     .1612203    8.255679
                                     27  |   1.304053   1.309469     0.26   0.791     .1822043    9.333232
                                     28  |   1.405185   1.412924     0.34   0.735      .195814    10.08378
                                     29  |   1.179113    1.18674     0.16   0.870     .1640018    8.477397
                                     30  |   .9834659   .9916014    -0.02   0.987     .1363064    7.095814
                                     31  |    .479524   .6781882    -0.52   0.603     .0299889    7.667611
                                     32  |    1.48924     1.4913     0.40   0.691     .2092114    10.60093
----------------------------------------------------------------------------------------------------------

. test 1.exposed#1.hosp_lte_1w

 ( 1)  1.exposed#1.hosp_lte_1week = 0

           chi2(  1) =   37.88
         Prob > chi2 =    0.0000

. lincom 1.exposed, hr

 ( 1)  1.exposed = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.245689   .0584241     4.68   0.000     1.136286    1.365627
------------------------------------------------------------------------------

. lincom 1.exposed + 1.exposed#1.hosp_lte_1w, hr

 ( 1)  1.exposed + 1.exposed#1.hosp_lte_1week = 0

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.916934   .1105738    11.28   0.000     1.712015    2.146381
------------------------------------------------------------------------------

. 
. safecount if _d==1 & group==2 & anycrit==1
  0

. stcox exposed age1 age2 age3 male i.stp if anycrit==0

         failure _d:  deathindicator
   analysis time _t:  (deathexit-origin)
             origin:  time entrydate
  enter on or after:  time entrydate

Iteration 0:   log likelihood = -35915.435
Iteration 1:   log likelihood = -34704.731
Iteration 2:   log likelihood = -34304.842
Iteration 3:   log likelihood = -34297.646
Iteration 4:   log likelihood = -34297.413
Iteration 5:   log likelihood = -34297.412
Refining estimates:
Iteration 0:   log likelihood = -34297.412

Cox regression -- Breslow method for ties

No. of subjects =       37,972                  Number of obs    =      37,972
No. of failures =        3,492
Time at risk    =     10155790
                                                LR chi2(36)      =     3236.05
Log likelihood  =   -34297.412                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     exposed |    1.69056   .0648423    13.69   0.000     1.568131    1.822548
        age1 |   1.086134   .0117501     7.64   0.000     1.063347     1.10941
        age2 |   .9735627   .0171552    -1.52   0.128     .9405131    1.007774
        age3 |   1.088043   .0660207     1.39   0.164     .9660435     1.22545
        male |   1.192972    .040889     5.15   0.000     1.115464    1.275866
             |
         stp |
          2  |   1.018297   1.019554     0.02   0.986     .1430941     7.24648
          3  |   1.334883   1.338116     0.29   0.773     .1871459    9.521519
          4  |   1.031555   1.043561     0.03   0.976     .1420313    7.492051
          5  |   1.178582    1.20406     0.16   0.872      .159132    8.728957
          6  |   1.256512   1.258338     0.23   0.820     .1764931    8.945515
          7  |   .7191428   .7485454    -0.32   0.751        .0935     5.53119
          8  |   1.069348   1.072392     0.07   0.947     .1497943    7.633841
          9  |   1.139871    1.14841     0.13   0.897      .158226     8.21171
         10  |   1.169065   1.172046     0.16   0.876     .1638576    8.340858
         11  |   1.165055   1.169083     0.15   0.879     .1630055    8.327043
         12  |   .8221116   .8314571    -0.19   0.846     .1132539    5.967721
         13  |   .7501496   .7551152    -0.29   0.775     .1043066    5.394907
         14  |   1.071307    1.07765     0.07   0.945     .1491669    7.694059
         15  |   .8566933   .8616689    -0.15   0.878     .1193109    6.151352
         16  |   .9936574   .9976953    -0.01   0.995     .1388596    7.110453
         17  |   1.081829   1.090748     0.08   0.938     .1499476    7.805087
         18  |   1.113411   1.118005     0.11   0.915     .1555757    7.968364
         19  |   1.013774   1.021398     0.01   0.989     .1407143    7.303718
         20  |   1.217978   1.226792     0.20   0.845     .1691523     8.77003
         21  |   .6242011   .6266711    -0.47   0.639     .0872479    4.465748
         22  |   .2446474   .2825196    -1.22   0.223     .0254431    2.352399
         23  |   .8904885   .8970621    -0.12   0.908     .1236355    6.413771
         24  |   .9799978    1.09577    -0.02   0.986     .1095133    8.769674
         25  |   .8942532   .9218461    -0.11   0.914     .1185754     6.74414
         26  |   .9514558   .9552944    -0.05   0.960     .1329698    6.808074
         27  |   1.060912   1.065321     0.06   0.953     .1482314    7.593092
         28  |   1.110854   1.117015     0.10   0.917     .1547871    7.972225
         29  |   .9911285   .9976092    -0.01   0.993      .137836    7.126844
         30  |   .8190589   .8258235    -0.20   0.843     .1135229    5.909446
         31  |    .435481   .6158973    -0.59   0.557     .0272346    6.963326
         32  |   1.240922   1.242634     0.22   0.829     .1743285     8.83325
------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  e:\analyses\post-admission-admissions-research\analysis/output/an_deathvsflu_interactions.log
  log type:  text
 closed on:  12 May 2021, 10:42:55
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
